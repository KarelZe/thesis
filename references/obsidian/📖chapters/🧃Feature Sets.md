**Why:**
The goal of my feature set definition is: 
1. Have a minimal feature set required to calculate LR, EMO or CLNV. →  Makes it easier to transfer our method to other markets.
2. Extend the minimal feature set for date-time features. →  Makes it easy to transfer our method to other markets, but also takes into account temporal info.
3. Have an extended feature set to calculate the SOTA of Grauer et. al. → Makes it easy to compare with the previous baseline.
4. Add time and option features. → Makes sense, as we look at an option data set. Temporal features are easy to derive. 
5. Scaling is typically not required for gradient boosting, but is useful for neural networks. But both $z$-scaling and min-max-scaling don't change the distribution of data. (see [here.](https://stats.stackexchange.com/a/562204/351242)).
6. Do not discretize features just because it's done in rules due to hard hard borders. (see [[@kuhnFeatureEngineeringSelection2020]])(p. 130) We use ratios or differences instead. This is needed as some models can not synthesize ratios or differences (see [[@heatonEmpiricalAnalysisFeature2016]])

**Other research:**
- Add frequency of trade and order imbalances as features. Came up with this idea when reading [[@aitkenIntradayAnalysisProbability1995]]
- Some feature ideas like order imbalance could be adapted from [[@aitkenIntradayAnalysisProbability1995]].
- [[@blazejewskiLocalNonParametricModel2005]] use more previous trades to a $k$-nn search. Not feasible, as my data set only contains the previous trade and it misses rather often already.
- [[@ronenMachineLearningTrade2022]] suggest to use models that can handle time series components. This would limit our choices. Thus we use feature engineering to induce a notion of time into our models.

“An interesting upshot of these results is that the aggressor side of trading appears little related to any underlying information, a decoupling that we argue arises from how trading transpires in modern high frequency markets. Our findings complement recent work by Collin-Dufresne and Vos (2015) who find that standard measures of adverse selection relying on estimates of the persistent price effect” (Easley et al., 2016, p. 270)

“In addition to the location of transaction prices relative to the quotes, we also examine other factors that affect classification accuracy rates. These factors include tick condition, trade size, time between the current trade and the immediate previous trade (trade distance), time between the current trade and the last quote update (quote distance), and the percentage spread. Our results indicate that the probability of correct classification is positively correlated with the percentage spread, trade distance, and quote distance and negatively correlated with trade size” ([[@chakrabartyTradeClassificationAlgorithms2007]] 2007, p. 3808)

For their analysis they also apply the log, but do not state why: “Eq. (2) is the probit model and Eq. (1) is the trading cost equation. Yi is effective spread, Xi is a vector of variables that includes the log of market capitalization, the log of trade size, the inverse of price, and the number of market makers.” ([[@chakrabartyTradeClassificationAlgorithms2007]], p. 3817)

<mark style="background: #ABF7F7A6;">TODO: Add to each feature, where it has been used.
TODO: Point out some interesting features here in the text.
TODO: We are less concerned about providing redundant data to the model, as trees do not base their splitting process on correlation. Also, with neural nets being a universal function approximator.
TODO: explain why we don't discretize / binarize features, other than classical models. See [[@kuhnFeatureEngineeringSelection2020]]
TODO: Explain why we don't include the results of the classical rules themselves, due to redundant low-precision encoding. May give an example explaining for decision trees.
TODO: Adress the usefullness of the engineered features. Sketch the results of the *adversarial validation*. Which features are very different in the training set and the validation set? Which features are most important in adversarial validation?
TODO: Plot distributions of features from training and validation set. Could also test using https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test test if samples are drawn from the same distribution.
TODO: Economic intuition:  [[@zhuClusteringStructureMicrostructure2021 1]]
TODO: For different types of spreads see [[@zhuClusteringStructureMicrostructure2021 1]]
TODO: Introduce the word "feature crosses" and motivation in deep learning https://stats.stackexchange.com/questions/349155/why-do-neural-networks-need-feature-selection-engineering/349202#349202
https://financetrain.com/why-lognormal-distribution-is-used-to-describe-stock-prices
</mark>

Ratio between trade price and Nbbo:
g designated market makers). To investigate these three hypotheses further, we extract the trade and data from the TAQ database for each of the stocks within each packagThis content downloaded from 141.52.248.2 on Sun, 09 Apr 2023 15:08:08 UTC All use subject to ht Kavajecz and Keim 481 each individual stock symbol, we collect all trades and quotes for the nine-day period beginning three days before the auction date and ending five days after the auction date. In preparing the trade and quote data to be used in calculating the variables of interest, we conduct the standard adjustments. First, the national best bid and offer (NBBO) is calculated over the nine-day window for each stock. Second, trades are adjusted using the Lee and Ready (1991) five-second rule and are designated as buyer- or seller-initiated using the Lee and Ready classification scheme. In particular, trades are designated as buyer- (seller-) initiated if the trade price is above (below) the current NBBO midpoint. For trades at the NBBO midpoint, the initiator is determined by whether the last transaction price change was an uptick (buy) or downtick (sell). Using the trade and quote data, we construct three variables that are relevant for Hypotheses 1-3: i) cumulative market-adjusted returns, ii) net dollar trading volume in the direction of the package trade, and iii) a trading efficiency measure. We discuss the construction of each in turn. To construct cumulative market-adjusted returns, we compute daily returns for each stock using end-of-day quote midpoints, then the return of the Russell 2000 value index over the corresponding day is subtracted to obtain a measure of market-adjusted movement for each stock. We use the Russell 2000 value index to match the small-cap value characteristics of the stocks in our sample (which are dictated by the investment style of the asset manager). Having normalized the market-adjusted return of each stock to one the day before the auction, we cumulate the market-adjusted return for six days beginning on the auction day. We construct a weighted average separately for buys and sells and for three categories of size for the package trades, where the weights are the dollar volume of the package trade. The three size groups are: small trades, including trades that make up less than 50% of that stock's average daily dollar volume; medium trades, including trades between 50% and 100% of average daily dollar volume; and large trades, including trades larger than the average dollar volume traded in one day. Our dollar trading volume variable is based on the difference between trad ing volume in the direction of the package trade vs. trading volume against the direction of the package trade. For each half-hour period, we sum separately the buyer- and seller-initiated dollar trading volume associated with each stock in the package. Given the substantial differences in trading volume across stocks in the sample, we normalize the dollar trading volume by dividing the buyer- and seller-initiated dollar trading volume by the average daily dollar trading volume for that stock (measured over the prior 12 months). We then assign a trade direc tion to the volume series associated with each particular trade within the package. Specifically, if a stock is to be purchased (sold) within a package, then the buyer initiated (seller-initiated) volume is designated as volume with the package trade and the seller-initiated (buyer-initiated) volume is designated as volume against the package trade. For both series, volume with and against the package trade, we construct a weighted average (again the weights are the dollar volume of the pack age trade) where stocks are allocated to a category according to the stock's trade size (small, medium, and large). Finally, we cumulate the difference between the volume with the package trade and the volume against the package trade. By cumulating the difference between the volume with and the volume against the This content downloaded from 141.52.248.2 on Sun, 09 Apr 2023 15:08:08 UTC All use subject to ht 482 Journal of Financial and Quantitative Analysis trade, we have a measure of the net volume in the direction of the package trade for each half-hour period over the window. Our third variable measures where trade prices are executed relative to the NBBO at the time of the trade. For each buyer-initiated trade, we calculate the ratio of the trade price to the existing national best ask quote, while for each seller-initiated trade we calculate the ratio of the existing national best bid quote to the trade price. This ratio, which we refer to as our trading efficiency variable, provides a measure of where the transaction price occurs relative to the corre sponding NBBO quote. Ratio values less than one denote trade prices within the NBBO spread that contain price improvement, while values greater than one de note trade prices outside the NBBO spread that contain price concessions. Like the trading volume variable, we assign a trade direction to the buyer- and seller initiated trading efficiency series based on the direction of the associated trade within the package. This results in a trading efficiency measure with the trade and a trading efficiency measure against the trade. Similar to the net volume variable, we compute a weighted average of the trading efficiency measures separately for the three trade size categories (small, medium, and large). ([[@kavajeczPackagingLiquidityBlind2005]])



| Feature               | Feature Category             | FS 1 (Classical) | FS 2 (F 1 + Grauer) | FS 3 (FS 2 + Others) | Transform |
|-----------------------|------------------------------|------------------|---------------------|----------------------|-----------|
| TRADE_PRICE           | tick rule                    | x                | x                   | x                    | log       |
| price_ex_lag          | tick rule                    | x                | x                   | x                    | log       |
| price_all_lag         | tick rule                    | x                | x                   | x                    | log       |
| chg_ex_lag            | tick rule                    | x                | x                   | x                    |           |
| chg_all_lag           | tick rule                    | x                | x                   | x                    |           |
| price_ex_lead         | reverse tick rule            | x                | x                   | x                    | log       |
| price_all_lead        | reverse tick rule            | x                | x                   | x                    | log       |
| chg_ex_lead           | reverse tick rule            | x                | x                   | x                    |           |
| chg_all_lead          | reverse tick rule            | x                | x                   | x                    |           |
| BEST_BID              | quote rule                   | x                | x                   | x                    | log       |
| bid_ex                | quote rule                   | x                | x                   | x                    | log       |
| BEST_ASK              | quote rule                   | x                | x                   | x                    | log       |
| ask_ex                | quote rule                   | x                | x                   | x                    | log       |
| prox_ex               | EMO / CLNV                   | x                | x                   | x                    |           |
| prox_best             | EMO / CLNV                   | x                | x                   | x                    |           |
| bid_ask_size_ratio_ex | depth rule                   |                  | x                   | x                    |           |
| bid_size_ex           | depth rule / trade size rule |                  | x                   | x                    |           |
| ask_size_ex           | depth rule / trade size rule |                  | x                   | x                    |           |
| rel_bid_size_ex       | trade size rule              |                  | x                   | x                    |           |
| rel_ask_size_ex       | trade size rule              |                  | x                   | x                    |           |
| TRADE_SIZE            | trade size rule              |                  | x                   | x                    |           |
| STR_PRC               | option                       |                  |                     | x                    | log       |
| day_vol               | option                       |                  |                     | x                    | log       |
| bin_root              | option                       |                  |                     | x                    | binarize  |
| time_to_maturity      | option                       |                  |                     | x                    |           |
| moneyness             | option                       |                  |                     | x                    |           |
| bin_option_type       | option                       |                  |                     | x                    | binarize  |
| bin_issue_type        | option                       |                  |                     | x                    | binarize  |