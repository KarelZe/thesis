
![[feature-and-feature-set-definition.png]]


**Ideas:**
-   While the determination of average trade sizes allows further gauging of common and larger trade sizes, the initial order size must also be considered. In electronic markets, and particularly in options, price guidance is given by quotes. Trade initiators rarely trade at these quoted prices (5-20% of options screen volume), and mostly enter limit orders mid-market. The difference between order and trade sizes is twofold. Firstly, a trade initiator may slice an order into suborders to minimize market impact by trading 500 futures or options via 5 orders at 100 contracts. Trade records provide evidence for this practice as the trade executions feature the same counterparty on the trade at identical prices with subsequent, virtually identical timestamps. Secondly, other market participants respond to incoming orders from trade initiators in a competitive fashion with immediate-or-cancel (IOC) orders. The initial order of 500 contracts placed a tick under the best quoted offer may be traded by, for example, 3 market makers sending IOCs in 100, 100 and 300 contracts. (https://www.esma.europa.eu/sites/default/files/esma_mifid_add_fese_replyform_1.docx)

- https://www.jstor.org/stable/2962317?seq=12 and [[@berkmanLargeOptionTrades1996]]

In an idealized setting where the noise traders/trade initiators place a market order that executes against a limit order or against posted quotes, we can accurately identify the side that initiated the trade based on whether it was executed at the ask price or the bid price. Although such a setting is not a complete depiction of real world stock markets, the literature typically uses such an algorithm to identify the side that initiates the trade because trade initiators are more likely to place market orders since they are less likely to accept the risk of not consummating their trades. In contrast, market makers are more likely to place limit orders because their primary objective is not to take a position in the stock but to clear the market and to profit from the spread. It is possible that some noise traders/trade initiators may place limit orders rather than market orders with the hope of executing trades at a more favorable price. In such instances, trades would cross between two trade initiators rather than between an active trade initiator and a market maker. Such trades add noise to the measure of order flow but as long as some of the trades are truly between active trade initiators and market makers, the net order flow is still an unbiased measure of net trades initiated for a particular stock. The key point to note here is that market makers are involved in at least some of the trades as liquidity providers, and the hypotheses that we examine do not apply to them. https://abfer.org/media/abfer-events-2013/annual-conference/investment-finance/track3-buyers-versus-sellers-who-initiates-trades-and-when.pdf

“An interesting upshot of these results is that the aggressor side of trading appears little related to any underlying information, a decoupling that we argue arises from how trading transpires in modern high frequency markets. Our findings complement recent work by Collin-Dufresne and Vos (2015) who find that standard measures of adverse selection relying on estimates of the persistent price effect” ([[@easleyDiscerningInformationTrade2016]] p. 270)


**Other research:**
-   While the determination of average trade sizes allows further gauging of common and larger trade sizes, the initial order size must also be considered. In electronic markets, and particularly in options, price guidance is given by quotes. Trade initiators rarely trade at these quoted prices (5-20% of options screen volume), and mostly enter limit orders mid-market. The difference between order and trade sizes is twofold. Firstly, a trade initiator may slice an order into suborders to minimize market impact by trading 500 futures or options via 5 orders at 100 contracts. Trade records provide evidence for this practice as the trade executions feature the same counterparty on the trade at identical prices with subsequent, virtually identical timestamps. Secondly, other market participants respond to incoming orders from trade initiators in a competitive fashion with immediate-or-cancel (IOC) orders. The initial order of 500 contracts placed a tick under the best quoted offer may be traded by, for example, 3 market makers sending IOCs in 100, 100 and 300 contracts. (https://www.esma.europa.eu/sites/default/files/esma_mifid_add_fese_replyform_1.docx)
- In an idealized setting where the noise traders/trade initiators place a market order that executes against a limit order or against posted quotes, we can accurately identify the side that initiated the trade based on whether it was executed at the ask price or the bid price. Although such a setting is not a complete depiction of real world stock markets, the literature typically uses such an algorithm to identify the side that initiates the trade because trade initiators are more likely to place market orders since they are less likely to accept the risk of not consummating their trades. In contrast, market makers are more likely to place limit orders because their primary objective is not to take a position in the stock but to clear the market and to profit from the spread. It is possible that some noise traders/trade initiators may place limit orders rather than market orders with the hope of executing trades at a more favorable price. In such instances, trades would cross between two trade initiators rather than between an active trade initiator and a market maker. Such trades add noise to the measure of order flow but as long as some of the trades are truly between active trade initiators and market makers, the net order flow is still an unbiased measure of net trades initiated for a particular stock. The key point to note here is that market makers are involved in at least some of the trades as liquidity providers, and the hypotheses that we examine do not apply to them. https://abfer.org/media/abfer-events-2013/annual-conference/investment-finance/track3-buyers-versus-sellers-who-initiates-trades-and-when.pdf
- “An interesting upshot of these results is that the aggressor side of trading appears little related to any underlying information, a decoupling that we argue arises from how trading transpires in modern high frequency markets. Our findings complement recent work by Collin-Dufresne and Vos (2015) who find that standard measures of adverse selection relying on estimates of the persistent price effect” ([[@easleyDiscerningInformationTrade2016]] p. 270)
- Add frequency of trade and order imbalances as features. Came up with this idea when reading [[@aitkenIntradayAnalysisProbability1995]]
- [[@berkmanLargeOptionTrades1996]]
- Some feature ideas like order imbalance could be adapted from [[@aitkenIntradayAnalysisProbability1995]].
- [[@blazejewskiLocalNonParametricModel2005]] use more previous trades to a $k$-nn search. Not feasible, as my data set only contains the previous trade and it misses rather often already.
- [[@ronenMachineLearningTrade2022]] suggest to use models that can handle time series components. This would limit our choices. Thus we use feature engineering to induce a notion of time into our models.
- “In addition to the location of transaction prices relative to the quotes, we also examine other factors that affect classification accuracy rates. These factors include tick condition, trade size, time between the current trade and the immediate previous trade (trade distance), time between the current trade and the last quote update (quote distance), and the percentage spread. Our results indicate that the probability of correct classification is positively correlated with the percentage spread, trade distance, and quote distance and negatively correlated with trade size” ([[@chakrabartyTradeClassificationAlgorithms2007]] 2007, p. 3808) -> ok, but doesn't really fit here.
- Ratio between trade price and Nbbo:g designated market makers). To investigate these three hypotheses further, we extract the trade and data from the TAQ database for each of the stocks within each packagThis content downloaded from 141.52.248.2 on Sun, 09 Apr 2023 15:08:08 UTC All use subject to ht Kavajecz and Keim 481 each individual stock symbol, we collect all trades and quotes for the nine-day period beginning three days before the auction date and ending five days after the auction date. In preparing the trade and quote data to be used in calculating the variables of interest, we conduct the standard adjustments. First, the national best bid and offer (NBBO) is calculated over the nine-day window for each stock. Second, trades are adjusted using the Lee and Ready (1991) five-second rule and are designated as buyer- or seller-initiated using the Lee and Ready classification scheme. In particular, trades are designated as buyer- (seller-) initiated if the trade price is above (below) the current NBBO midpoint. For trades at the NBBO midpoint, the initiator is determined by whether the last transaction price change was an uptick (buy) or downtick (sell). Using the trade and quote data, we construct three variables that are relevant for Hypotheses 1-3: i) cumulative market-adjusted returns, ii) net dollar trading volume in the direction of the package trade, and iii) a trading efficiency measure. We discuss the construction of each in turn. To construct cumulative market-adjusted returns, we compute daily returns for each stock using end-of-day quote midpoints, then the return of the Russell 2000 value index over the corresponding day is subtracted to obtain a measure of market-adjusted movement for each stock. We use the Russell 2000 value index to match the small-cap value characteristics of the stocks in our sample (which are dictated by the investment style of the asset manager). Having normalized the market-adjusted return of each stock to one the day before the auction, we cumulate the market-adjusted return for six days beginning on the auction day. We construct a weighted average separately for buys and sells and for three categories of size for the package trades, where the weights are the dollar volume of the package trade. The three size groups are: small trades, including trades that make up less than 50% of that stock's average daily dollar volume; medium trades, including trades between 50% and 100% of average daily dollar volume; and large trades, including trades larger than the average dollar volume traded in one day. Our dollar trading volume variable is based on the difference between trad ing volume in the direction of the package trade vs. trading volume against the direction of the package trade. For each half-hour period, we sum separately the buyer- and seller-initiated dollar trading volume associated with each stock in the package. Given the substantial differences in trading volume across stocks in the sample, we normalize the dollar trading volume by dividing the buyer- and seller-initiated dollar trading volume by the average daily dollar trading volume for that stock (measured over the prior 12 months). We then assign a trade direc tion to the volume series associated with each particular trade within the package. Specifically, if a stock is to be purchased (sold) within a package, then the buyer initiated (seller-initiated) volume is designated as volume with the package trade and the seller-initiated (buyer-initiated) volume is designated as volume against the package trade. For both series, volume with and against the package trade, we construct a weighted average (again the weights are the dollar volume of the pack age trade) where stocks are allocated to a category according to the stock's trade size (small, medium, and large). Finally, we cumulate the difference between the volume with the package trade and the volume against the package trade. By cumulating the difference between the volume with and the volume against the This content downloaded from 141.52.248.2 on Sun, 09 Apr 2023 15:08:08 UTC All use subject to ht 482 Journal of Financial and Quantitative Analysis trade, we have a measure of the net volume in the direction of the package trade for each half-hour period over the window. Our third variable measures where trade prices are executed relative to the NBBO at the time of the trade. For each buyer-initiated trade, we calculate the ratio of the trade price to the existing national best ask quote, while for each seller-initiated trade we calculate the ratio of the existing national best bid quote to the trade price. This ratio, which we refer to as our trading efficiency variable, provides a measure of where the transaction price occurs relative to the corre sponding NBBO quote. Ratio values less than one denote trade prices within the NBBO spread that contain price improvement, while values greater than one de note trade prices outside the NBBO spread that contain price concessions. Like the trading volume variable, we assign a trade direction to the buyer- and seller initiated trading efficiency series based on the direction of the associated trade within the package. This results in a trading efficiency measure with the trade and a trading efficiency measure against the trade. Similar to the net volume variable, we compute a weighted average of the trading efficiency measures separately for the three trade size categories (small, medium, and large). ([[@kavajeczPackagingLiquidityBlind2005]])

“In addition to the location of transaction prices relative to the quotes, we also examine other factors that affect classification accuracy rates. These factors include tick condition, trade size, time between the current trade and the immediate previous trade (trade distance), time between the current trade and the last quote update (quote distance), and the percentage spread. Our results indicate that the probability of correct classification is positively correlated with the percentage spread, trade distance, and quote distance and negatively correlated with trade size” ([[@chakrabartyTradeClassificationAlgorithms2007]] 2007, p. 3808)

TODO: We are less concerned about providing redundant data to the model, as trees do not base their splitting process on correlation. Also, with neural nets being a universal function approximator.
TODO: explain why we don't discretize / binarize features, other than classical models. See [[@kuhnFeatureEngineeringSelection2020]]
TODO: Explain why we don't include the results of the classical rules themselves, due to redundant low-precision encoding. May give an example explaining for decision trees.
TODO: Adress the usefullness of the engineered features. Sketch the results of the *adversarial validation*. Which features are very different in the training set and the validation set? Which features are most important in adversarial validation?
TODO: Plot distributions of features from training and validation set. Could also test using https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test test if samples are drawn from the same distribution.
https://financetrain.com/why-lognormal-distribution-is-used-to-describe-stock-prices


Ratio between trade price and Nbbo:
g designated market makers). To investigate these three hypotheses further, we extract the trade and data from the TAQ database for each of the stocks within each packagThis content downloaded from 141.52.248.2 on Sun, 09 Apr 2023 15:08:08 UTC All use subject to ht Kavajecz and Keim 481 each individual stock symbol, we collect all trades and quotes for the nine-day period beginning three days before the auction date and ending five days after the auction date. In preparing the trade and quote data to be used in calculating the variables of interest, we conduct the standard adjustments. First, the national best bid and offer (NBBO) is calculated over the nine-day window for each stock. Second, trades are adjusted using the Lee and Ready (1991) five-second rule and are designated as buyer- or seller-initiated using the Lee and Ready classification scheme. In particular, trades are designated as buyer- (seller-) initiated if the trade price is above (below) the current NBBO midpoint. For trades at the NBBO midpoint, the initiator is determined by whether the last transaction price change was an uptick (buy) or downtick (sell). Using the trade and quote data, we construct three variables that are relevant for Hypotheses 1-3: i) cumulative market-adjusted returns, ii) net dollar trading volume in the direction of the package trade, and iii) a trading efficiency measure. We discuss the construction of each in turn. To construct cumulative market-adjusted returns, we compute daily returns for each stock using end-of-day quote midpoints, then the return of the Russell 2000 value index over the corresponding day is subtracted to obtain a measure of market-adjusted movement for each stock. We use the Russell 2000 value index to match the small-cap value characteristics of the stocks in our sample (which are dictated by the investment style of the asset manager). Having normalized the market-adjusted return of each stock to one the day before the auction, we cumulate the market-adjusted return for six days beginning on the auction day. We construct a weighted average separately for buys and sells and for three categories of size for the package trades, where the weights are the dollar volume of the package trade. The three size groups are: small trades, including trades that make up less than 50% of that stock's average daily dollar volume; medium trades, including trades between 50% and 100% of average daily dollar volume; and large trades, including trades larger than the average dollar volume traded in one day. Our dollar trading volume variable is based on the difference between trad ing volume in the direction of the package trade vs. trading volume against the direction of the package trade. For each half-hour period, we sum separately the buyer- and seller-initiated dollar trading volume associated with each stock in the package. Given the substantial differences in trading volume across stocks in the sample, we normalize the dollar trading volume by dividing the buyer- and seller-initiated dollar trading volume by the average daily dollar trading volume for that stock (measured over the prior 12 months). We then assign a trade direc tion to the volume series associated with each particular trade within the package. Specifically, if a stock is to be purchased (sold) within a package, then the buyer initiated (seller-initiated) volume is designated as volume with the package trade and the seller-initiated (buyer-initiated) volume is designated as volume against the package trade. For both series, volume with and against the package trade, we construct a weighted average (again the weights are the dollar volume of the pack age trade) where stocks are allocated to a category according to the stock's trade size (small, medium, and large). Finally, we cumulate the difference between the volume with the package trade and the volume against the package trade. By cumulating the difference between the volume with and the volume against the This content downloaded from 141.52.248.2 on Sun, 09 Apr 2023 15:08:08 UTC All use subject to ht 482 Journal of Financial and Quantitative Analysis trade, we have a measure of the net volume in the direction of the package trade for each half-hour period over the window. Our third variable measures where trade prices are executed relative to the NBBO at the time of the trade. For each buyer-initiated trade, we calculate the ratio of the trade price to the existing national best ask quote, while for each seller-initiated trade we calculate the ratio of the existing national best bid quote to the trade price. This ratio, which we refer to as our trading efficiency variable, provides a measure of where the transaction price occurs relative to the corre sponding NBBO quote. Ratio values less than one denote trade prices within the NBBO spread that contain price improvement, while values greater than one de note trade prices outside the NBBO spread that contain price concessions. Like the trading volume variable, we assign a trade direction to the buyer- and seller initiated trading efficiency series based on the direction of the associated trade within the package. This results in a trading efficiency measure with the trade and a trading efficiency measure against the trade. Similar to the net volume variable, we compute a weighted average of the trading efficiency measures separately for the three trade size categories (small, medium, and large). ([[@kavajeczPackagingLiquidityBlind2005]])

