
## Four sources
1. Livevol intraday data with prices and quotes w/o trader type. Intraday option price data from `LiveVol` at a transaction level resolution. Intraday option quote data from `LiveVol`
2. EOD trade volumes w trader type through 
	- ISE Open/Close Trade Profile 
	- CBOE Open-Close Volume Summary
3. Ivy DB OptionMetrics

## LiveVol üé∞
- `LiveVol` dataset contains Specifially, the trade price and trade size / volume, nbbo quotes, quotes and quote sizes of the exchanges where the option is quoted and information on the exchange where the trade is executed (see [[@grauerOptionTradeClassification2022]])
- transaction-level option trades for  all major US exchanges
- Data spans from May 2, 2005 to May 31, 2017 + (new samples until 2020). The dates are chosen non-arbitrarily: May 2, 2005 is first day of ISE Open/ Close. May, 31 2017 is last day of availability. We adhere to the data ranges to maintain consistency with [[@grauerOptionTradeClassification2022]]
- filter: negative or zero volume, trading volumes $\geq$ 10 Mio contracts, multiple underlying symbols for the same root, duplicates and, canceled trades (Coditions `40, 41 ...` (?)).
- Is the delay between trades and quotes relevant here? Probably not, due to how matching is performed in [[@grauerOptionTradeClassification2022]] (See discussion in [[@rosenthalModelingTradeDirection2012]]) 

## Option Quotesü™ô
Specification: https://datashop.cboe.com/documents/Option_Quotes_Layout.pdf

## Open / Close üè¶
Specification: https://datashop.cboe.com/documents/OpenCloseSpecification.pdf
- contains daily trade volumes for the option series by trader type
1. Differentiated by whether position is opened `O` / closed `C`
2. Differentiated by buy  `B` and sell  `S` 
3. Differentiated by trader types: customer `C`, professional customer `U`, firm proprietary `F/L`, broker/dealer `B/J`. Market maker `M/N` 
4. Differentiated by volume: (<100 Contracts Each) (`SM`)
- aggregate buy and sell volumes by account type:
	- $\{C\} \times \{B\} \times \{O,C\}$ (Customer buy (against market maker?))
	- $\{C\} \times \{S\} \times \{O,C\}$ (Customer sell (against market maker?))
	-  $\{U\} \times \{B\} \times \{O,C\}$ (professional customer buy)
	- $\{U\} \times \{S\} \times \{O,C\}$ (professional customer sell)
	- $\left\{BJ \right\} \times \{B\} \times \{O,C\}$ (dealer buy)
	- $\left\{BJ \right\} \times \{S\} \times \{O,C\}$ (dealer sell)
	- $\left\{FL \right\} \times \{B\} \times \{O,C\}$ (firm proprietary buy)
	- $\left\{FL \right\} \times \{S\} \times \{O,C\}$ (firm proprietary sell)
- Sum all 8 groups to obtain total trade volume at exchange

https://www.nasdaqtrader.com/content/ProductsServices/DATAPRODUCTS/ISE/ISE-GEMX%20Consolidated%20Trade%20Profile%20FAQs%20v2.pdF
What do you mean by FIRM, CUSTOMER and PROFESSIONAL CUSTOMER trades, and can you provide an example? The four types of trades at ISE are: ÔÇ∑ MARKET MAKER ÔÇ∑ FIRM ÔÇ∑ CUSTOMER ÔÇ∑ PROFESSIONAL CUSTOMER If a retail trader enters an option order through a broker like optionsXpress, the broker will designate the order as a CUSTOMER order. When a member like Morgan Stanley or Goldman enters a trade on behalf of a large customer, institution or hedge fund, the trade is designated a CUSTOMER trade. When a member like Morgan Stanley or Goldman enters a trade for their own account, the trade is designated as FIRM trade. FIRM trades can be PROPRIETARY trades, executed on behalf of their own trading account or for another BROKER/DEALER who is not a member of the exchange. A PROFESSIONAL CUSTOMER is a high-activity CUSTOMER.

9. What is your definition of PROFESSIONAL CUSTOMER? ISE introduced a new trade designation on October 1, 2009 called PROFESSIONAL CUSTOMER. Anyone who is not trading for as a MARKET MAKER or FIRM account that enters more than 390 orders per day over the course of a one-month period is considered a PROFESSIONAL CUSTOMER.

## Matching procedure
- Classify transactions in the live vol data set, if the daily volume in livevol matches with customer buys or customer sells. What about professional customer orders?
- Mach based on  unique key of trade date, expiration date, strike price, option type, root symbol of underlying. (root, trade date, expiration date, strike price, option tpye, day vol). If both customer buy and sell orders at a day no decision can be inferred.
- Classify based on customer buy / sell indicator from customer buy or sell volumes. Similar to [[@theissenTestAccuracyLee2000]] and [[@ellisAccuracyTradeClassification2000]]. They assume customer is the party with demand for options. 
- Merge with option metrics data based on unique key


## Examples
‚ÄúThe main data are from Nanex, a firm specializing in delivering high quality data feeds. Nanex in turn obtains its data from standard sources: the Option Price Reporting Authority (OPRA) for options and the Securities Information Processor (SIP) for equities (TAQ data also are from the SIP). The Nanex data consist of all trades and intraday bid and ask quotes at 1-minute frequency for all U.S.-listed equity options and their underlying equities over the period from January 2004 to December 2015. The options quote data include the top of the limit order book for each options exchange, the stock quote data consists of the NBBO, and the timestamps are synchronized across markets. A limitation of this data set is that in order to reduce storage requirements it includes only 1-minute snapshots of quotes rather than every quote update, and for each day includes only the quotes for options contracts with at least one trade during that day. Even so, the data set is very large: it is 15 TB in compressed form and more than 100 TB uncompressed. We merge the Nanex data with the TAQ data by stock ticker and date, which allows us to further merge it with CRSP using the TAQ-CRSP linkage provided by WRDS. We use the TAQ data set only to facilitate merging the Nanex and CRSP data.‚Äù ([[@muravyevOptionsTradingCosts2020]], p. 4979)

‚Äú3. Data <mark style="background: #FFB86CA6;">Testing the empirical accuracy of the bulk volume and tick rule approaches requires market data. We evaluate alternative proxies for the underlying information we are trying to discern, with one of those proxies being the aggressor side of the trade. </mark>Individual equity data bases such as Nasdaq ITCH data<mark style="background: #ADCCFFA6;"> have buy-sell identifiers for each trade,</mark> but standard equity databases such as TAQ (Trade and Quote) do not. Moreover, because equity trading is fragmented across multiple markets, and signed data are not available for the vast majority of these market settings, 12 If we knew ÃÑ or q, we could correctly estimate p from the bulk volume value or the aggregate tick rule value. Using this procedure to<mark style="background: #ABF7F7A6;"> estimate the fraction of buys</mark> would be contrary to the spirit of the tick rule, which assigns individual trades as buys or sells and so produces a direct estimate of the fraction of buys determining the accuracy of classification algorithms in the equity market is a daunting task.13 Futures markets also have signed data (for a price), and futures have several advantages relative to equities. Futures trading is not fragmented, with each contract trading on only one market. Our statistical analysis demonstrates how noise affects classification accuracy, and noise in actual markets is greatly influenced by factors such as order matching protocols, book dynamics, and liquidity. Observing all trading in a contract allows us to characterize this noise and so test the implications of our model. Another advantage of futures is that all trades must occur at either the best bid or the best offer. This provides the tick rule approaches with the best possible setting as trades between the spread are not allowed. We chose for our sample three futures contracts: the Emini S&P 500 future, the gold future, and the West Texas Intermediate (WTI) crude oil future. These contracts trade in different markets with differing trading volume levels and order book activity. The E-mini S&P 500 futures trades on the Chicago Mercantile Exchange (CME) and is the most actively traded index futures contract, with an average daily volume of 2.2 million contracts. Gold futures trade on the Commodities Exchange (COMEX) and, while active, its trading volume is approximately one-fifth that of the E-mini. The WTI crude oil futures trades on the New York Mercantile Exchange (NYMEX) and is the most actively traded commodities contract. 3.1. E-mini S&P 500 futures <mark style="background: #ABF7F7A6;">We acquired tick data </mark>for the CME E-mini S&P 500 futures contract from November 7, 2010 to November 6, 2011. The database DataMine Market Depth provides all messages needed to recreate the book and trade data for any CME Globex trade product, time-stamped to the millisecond, following the FIX Adapted for Streaming (FAST) protocol.14 A variety of challenges arise in working with these data. The data come in a highly irregular format in which a single line can contain an arbitrary number of messages. Among these messages, we find anywhere between one and 19 trades per line. Most messages relate to requests to modify or cancel quotes. A trade cannot be identified by any particular FIX tag, but only by a combination of them (for example, when tag 269 = 2 after another tag 279 = 0, then tag 270 contains the price; tag 271, the traded size; tag 5797, the aggressor side; tag 52, the UTC (Coordinated Universal Time) transmission time; and tag 107, the instrument). Files mix messages from all E-mini S&P 500 futures contracts trading at that time, not only the front 13 See Chakrabarty, Moulton, and Shkilko (2012), who use INET data to test the accuracy of the Lee-Ready algorithm, and Chakrabarty, Pascual, and Shkilko (2015), who test bulk and tick rules using Nasdaq data. 14 This protocol receives frequent updates and modifications. In the context of this paper, we always refer to version 2.19, dated 12/09/11. These <mark style="background: #FFB8EBA6;">level 3 data </mark>were purchased directly from the CME and were delivered as 357 zip files containing 2,272 flat files. This represents about 21.6 gigabytes (GBs) of compressed data and about 220 GBs uncompressed. We mention these numbers to signal the difficulty of working with these data using standard commercial packages. contract, requiring care in separating trades from the different expirations. Exchanges also do not always report trades in the sequence they occurred, particularly when their networks are overloaded with dense traffic. Book updates are incremental, so losing or misplacing a message within the sequence of events means that the researcher will not reconstruct the book correctly, a particular problem for tick-based algorithms. Finally, some reported trades are fictional, and the only way to tell the difference with real trades is by checking the trade time (they are timestamped during periods when the exchange was closed). In short, a complex data handler needs to be programmed to extract the fields we need: time, price, volume, aggressor, and instrument.‚Äù ([[@easleyDiscerningInformationTrade2016]] p. 275)

‚ÄúII. Data The sample contains 313 Nasdaq stocks traded between September 27,1996, and September 29, 1997. These stocks began trading following their IPO sometime during this period. Consequently, for each stock, the time series of data varies from three months to 12 months. The transactions data are provided by the NASD and taken from their Market Data Server (MDS).3 Overall, the sample contains 2,433,019 trades and 627,370 quotes. Because the sample contains newly traded firms, it is worth comparing its characteristics to those of Nasdaq stocks as a whole. Using information from the CRSP tapes, we compared our sample to the Nasdaq universe (4700 stocks) in terms of market capitalization and trading volume. While the sample firms have a lower market capitalization than the average Nasdaq stock during this pe? riod ($172m and $322m, respectively), the median firm in the sample has a larger market value than the median Nasdaq stock ($112m and $66m, respectively). <mark style="background: #FFB86CA6;">This suggests that the sample has stocks of greater uniformity,</mark> and does not have extreme stocks in terms of size. Also, the turnover rate ofthe sample stocks is 0.83% per day, which is larger than is typical for a stock traded on Nasdaq (0.60%). This is not surprising given the very high trading volume immediately after the IPO. When we eliminate the first month of trading for each firm, the turnover mean (and median) of the sample is 0.60% (0.49%), which is not different from those for Nasdaq as a whole.4 Overall, at least in terms of market value and turnover, our sample stocks seem to be quite representative of Nasdaq stocks. <mark style="background: #BBFABBA6;">Our proprietary data provide the bid quote, the ask quote, the transaction price, the trade volume, a trader identity code, and a buy/sell indicator.5 The buy/sell indicator specifies the direction of the reporting party. If the seller re? ported the trade, then the trade would be called a sale regardless of the price at which it occurred. Thus, this indicator tells us the buyer and the seller in the trans? action, but not the trade direction per se. We can determine whether the trade was a buy or a sale by using the trader identity code in conjunctioh with the buy/sell indicator. The trader identity code is a four-letter code for every NASD member. </mark>When a non-NASD member trades (e.g., a customer trading with his NASD member broker), the trader identity code is blank. Thus, we can identify market makers and brokers by name, while the blank identity code merely tells us that a customer is trading.6 We use three broad categories of trades: transactions be? tween market makers, between ma‚Äù ([[@ellisAccuracyTradeClassification2000]], p. 532)


‚Äú3.1. Data <mark style="background: #FFB86CA6;">To examine the accuracy of each trade classification algorithm, we compare the true trade initiator obtained directly from the order book data with the three alternative methods of inferring trade direction:</mark> the BVC, the TR, and the LR. Our data come from two sources: (i) order book data are from the TotalView-ITCH database provided by NASDAQ and (ii) quotes and trades data are from the Daily TAQ (DTAQ) database provided by the NYSE. The ITCH data allow us to infer true trade initiator as it contains all displayed order entries, executions, modifications, and cancellations time stamped to the nanosecond. Every visible order entered in the book generates an Add Order message, and trades generate an Execution message. From the ITCH data, we collect time-stamped information on executed volume, execution price, and the buy/sell flag associated with each trade. From the DTAQ database we obtain NBBO quotes and trades for the entire U.S. marketplace. Holden and Jacobsen (2014) show that using DTAQ is preferred to using the more conventional Monthly TAQ (MTAQ) because MTAQ suffers from problems caused by withdrawn quotes, insufficient time stamp granularity, and several others. <mark style="background: #BBFABBA6;">We use DTAQ in two ways.</mark> First, we use DTAQ quotes for the LR algorithm. Second, we use DTAQ quotes and trades to examine how the BVC, the TR, and the LR perform when applied to consolidated data. We explain the details of this approach in Section 3.4. 3.2. Sample construction To build our sample, we rely on filters suggested in the literature and on a set of additional filters that are important in our setting. Following Chakrabarty, Moulton, and Shkilko (2012) and Hasbrouck 9  and Saar (2013), we begin with the CRSP universe of stocks and restrict it to the NASDAQ-listed common stocks (SHRCD¬º10 or 11, EXCH¬º3). We exclude NASDAQ Capital Market stocks that do not qualify for the NASDAQ Global Market. We drop stocks whose end-of-day prices are $1 or less on any day during our sample period and also drop stocks delisted during the sample period. <mark style="background: #BBFABBA6;">We further exclude stocks </mark>for which CRSP does not contain daily records on prices and volume. Finally, to ensure the credibility of our trade-based statistics, <mark style="background: #FFF3A3A6;">we require that sample stocks have at least ten trades o</mark>n every sample day. <mark style="background: #FFB8EBA6;">These filters retain </mark>1,471 stocks. We divide these stocks into three groups by market capitalization (group 1 contains 500 largest stocks, group 2 contains stocks with market capitalization ranks from 501 to 1,000, and group 3 contains the remaining stocks). In each group, we retain the 300 largest stocks, sort these by ticker symbol, and then select every third stock. This procedure results in 300 stocks (100 from each size group) with a significant size difference between the groups. We note that ELO focus on the three most actively traded futures contracts. To ensure proper comparison with their findings, in some of the subsequent tests we examine the ten largest stocks in our sample. We report the summary statistics for our sample in the Online Appendix. <mark style="background: #FFB86CA6;">The sample contains a number of frequently traded</mark> stocks whose trading volume compares well with the three futures contracts examined by ELO. For example, the average daily trading volume for the 100 largest stocks in our sample is 2.5 million shares, while the E-mini S&P 500 futures used by ELO trade on average 2.2 million contacts per day. Meanwhile, the daily volume in our top 10 stocks is over 9.2 million shares. We note that futures transactions are often smaller than equity transactions, and as such the Emini contract trades more frequently than our largest stocks. It is possible that BVC's superior performance in futures may be due to more frequent transactions. <mark style="background: #FF5582A6;">However, our goal is to examine</mark> BVC applicability to equities rather than to dispute its usefulness for the futures. Therefore, by construction, our set of stocks is representative of the universe of equities based on market capitalization, and our findings should be of interest to researchers working with various stock samples.‚Äù ([[@chakrabartyEvaluatingTradeClassification2015]], p. 57)

‚ÄúThe evaluation of the algorithms is based on equity trading data from NASDAQ‚Äôs electronic limit order book constructed from NASDAQ‚Äôs TotalView-ITCH data.9 The trade data contain all transactions against visible and hidden limit orders with information on the price and volume of the transaction. The order book data contain the development of the order book. That is, whenever a visible limit order that affects the best quotes is submitted, canceled (partially or completely) or executed, the order book contains an entry of the best bid or ask indicating the new price and volume available. Changes regarding hidden orders are not displayed in the order book. The data covers the continuous trading phase from 9:30 a.m. to 4 p.m. for all trading days during the three-month period from May to July 2011. I selected the 30 largest stocks (by market capitalization) in 2015 from the 11 NASDAQ industry sectors.10 Following Chakrabarty et al. (2015), I drop stock-days with an end-of-day price of less than one dollar or with less than 10 trades, which leaves me with a total of 19,842 stock-days. <mark style="background: #FFB86CA6;">Summary statistics are provided in Table </mark>A1 in the Appendix.11 My proposed algorithm is designed to offer improvements when the number of quote changes at a given timestamp is relatively high (i.e. at high quotation frequency relative to the timestamp precision). Fig. 2 shows the distribution of the number of quote changes (outliers omitted) at the times of trades for different timestamp precisions: the original precision of nanoseconds (10‚àí9 of a second), as well as 10‚àí4 to 100 of a second. At a precision of 10‚àí4 of a second or higher, most of the trade times experience only a small number of quote changes, which would allow me to match trades to their quotes based only on the timing of the two. With decreasing timestamp precision, however, this number increases quickly.‚Äù ([[@jurkatisInferringTradeDirections2022]], p. 10)

‚ÄúEach record in the matched trade dataset reports the following information: date and execution time of a trade, trade size, price, the option‚Äôs parameters (put/call, expiration month and year, and strike price), the underlying security,‚Äù (Savickas and Wilson, 2003, p. 883)
‚Äú884 Journal of Financial and Quantitative Analysis the reporting trader‚Äôs type code, and a dummy variable that indicates whether the reporting trader bought or sold the option. Thus, there is one record for each trading party for all trades on CBOE. There are 826 individual underlying assets represented in the matched trade sample. Of the total, 428 are NYSE/AMEX stocks and 362 are Nasdaq/OTC stocks. There are 32 underlying assets categorized as market indexes (which correspond to BODB security type 6) and at least 90% of all option trades in these assets are for the SPX and OEX options. The balance are interest rate options. Options on NYSE/AMEX stocks account for 57.1 million contracts, Nasdaq/OTC stock options account for 23.4 million contracts, and index options account for 87.97 million contacts. <mark style="background: #ADCCFFA6;">For each record in the matched trade sample, one of five trader types is available:</mark> M, C, B, F, and N. The letter represents the account to which a trade is assigned. CBOE market makers are indicated by M, and public customer accounts are denoted by C. Broker-dealer accounts (as distinct from market maker accounts) are represented by B and are defined according to the SEC‚Äôs definition of a broker-dealer. These trades are done on their own behalf, not as agents (which would be listed as C trades). F and N indicate firm and non-member accounts. It is worth noting that CBOE members representing large financial conglomerates, such as Merrill Lynch or Fidelity, might trade as M, B, or F, depending on which account is to be assigned to the trade. The data do not provide information on the identity of each trader, only the type. Each record in the reported trade/quote dataset provides information on either a trade or a quote. For each trade, the same information is reported as in the matched trade dataset, excluding the trader type and the buy/sell indicator. The dataset also reports which trades are executed on RAES and which trades are cancelled. The record for each quote differs from that for a trade in that the size and transaction data are inapplicable, and the bid and ask prices are reported. All times are to the nearest second. <mark style="background: #ABF7F7A6;">We group all records in the matched trade dataset into pairs, one pair per trade</mark>. The two records in each pair have the same trade date, underlying security, option‚Äôs parameters, trade size, and trade price. The buy/sell indicators are different for the two records in each pair (a buy and a sell). The grouping is performed so that the times of execution reported by both traders are as close as possible (frequently they are the same).2 The result is that for each trade we have the information on what type of traders are the buyer and the seller. When the parties to each trade are identified, we match each trade from the matched trade dataset with a trade in the reported quote/trade dataset based on all the same variables, except the buy/sell indicator (not given in the trade/quote dataset). <mark style="background: #FFB86CA6;">The matching procedure accommodates the fa</mark>ct that RAES trades must have a market maker on exactly one side of the transaction. As a result, we obtain a full description of each trade, including the exact time of execution (as reported in the second dataset) and the most recent bid-ask quotes. 2The two time stamps are equal for 55.09% of all trades; the difference between time stamps does not exceed one, two, and five minutes for 78.7%, 85.26%, and 92.57% of all trades, respectively; and for 99.16% of all trades the time stamps do not differ by more than 30 minutes. The impact of these timing issues is investigated further in Section VI.A. The matching procedure produces a sample of 2,090,875 trades. There are 1,425,767 customer-market maker (CM) trades, which is 68.19% of the entire sample.3 BM trades comprise 13.04% of the sample; the corresponding numbers for MM, CC, and FM trades are 12.9%, 3.84%, and 1.2%. The remaining 0.83% of the sample consists of FC, FF, BC, BF, and BB trades, and of all trades involving non-members. Consistent with previous literature, we assume that all MC and BC trades are initiated by the customer, all MB trades are initiated by the broker, all MF and BF trades are initiated by the firm, and all MN and BN trades are initiated by the non-member.4 We are unable to sign all trades in which both parties have the same type (e.g., MM or CC trades) and trades among customers, firms, and non-members. As a result, we can determine a trade initiator in 1,733,212 trades, which is 82.89% of the original sample. All trades and quotes for which the underlying asset price is reported as zero and all cancelled trades are excluded from the sample. We exclude data errors, such as quotes for which the recorded ask is less than or equal to the recorded bid. For all non-RAES trades, the most recent quotes are used.5 For RAES trades, the most recent quotes with either bid or ask prices equal to the RAES trade price are used (because a RAES trade is automatically crossed with the market maker‚Äôs bid or ask price). <mark style="background: #BBFABBA6;">Trades for which valid quotes are unavailable are excluded</mark>. <mark style="background: #FF5582A6;">The final sample is</mark> 1,465,830 trades. Of these trades, 11.24% occur at the bid-ask spread midpoint, 15.32% occur inside the quotes other than midpoint, 67.41% occur at the quotes, and 6.03% are outside the quotes.‚Äù ([[@savickasInferringDirectionOption2003]], p. 885)

## Summary statistics
![[summary-statistic.png]]
(from [[@muravyevOptionsTradingCosts2020]])